# Cookie-based State Management

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î cookies –∑–∞–º—ñ—Å—Ç—å localStorage –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ—Ä–∑–∏–Ω–∏, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫—Ä–∞—â—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É SSR —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∞ –∫–ª—ñ—î–Ω—Ç–æ–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
lib/
‚îú‚îÄ‚îÄ store.ts           # Zustand store –∑ cookie persistence
‚îú‚îÄ‚îÄ cookies.ts         # –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cookies
‚îî‚îÄ‚îÄ server-cookies.ts  # –°–µ—Ä–≤–µ—Ä–Ω—ñ —Ö—É–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ cookies
```

## üîß –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. `store.ts` - Zustand Store

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `createJSONStorage` –¥–ª—è cookie persistence
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞–Ω –≤ cookies
- –ü—ñ–¥—Ç—Ä–∏–º—É—î –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –∫–æ—Ä–∑–∏–Ω–æ—é

### 2. `cookies.ts` - Cookie –£—Ç–∏–ª—ñ—Ç–∏

- `getCookie(name)` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è cookie
- `setCookie(name, value, days)` - –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è cookie
- `deleteCookie(name)` - –≤–∏–¥–∞–ª–µ–Ω–Ω—è cookie
- `parseCookies(header)` - –ø–∞—Ä—Å–∏–Ω–≥ cookie header –¥–ª—è SSR

### 3. `server-cookies.ts` - –°–µ—Ä–≤–µ—Ä–Ω—ñ —Ö—É–∫–∏

- `getServerCart()` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∑–∏–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
- `getServerCartItemCount()` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—ñ
- `getServerCartTotalPrice()` - –∑–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –∫–æ—Ä–∑–∏–Ω–∏

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ —Å—Ç–æ—Ä–æ–Ω–∞:

```typescript
import { useCartStore } from "@/lib/store";

const { addToCart, items } = useCartStore();
```

### –°–µ—Ä–≤–µ—Ä–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞:

```typescript
import { getServerCartItemCount } from "@/lib/server-cookies";

export default function Layout() {
  const cartItemCount = getServerCartItemCount();
  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ cartItemCount –¥–ª—è SSR
}
```

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ cookies –Ω–∞–¥ localStorage

1. **SSR –ø—ñ–¥—Ç—Ä–∏–º–∫–∞** - –¥–∞–Ω—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
2. **–ö—Ä–∞—â–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∞ –∫–ª—ñ—î–Ω—Ç–æ–º
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è** - –∑ –∫–æ–∂–Ω–∏–º HTTP –∑–∞–ø–∏—Ç–æ–º
4. **–ë–µ–∑–ø–µ–∫–∞** - –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ httpOnly, secure —Ñ–ª–∞–≥–∏

## ‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–Ω—è

1. **–†–æ–∑–º—ñ—Ä** - cookies –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω–Ω—è 4KB
2. **–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è** - cookies –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∑ –∫–æ–∂–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º
3. **–ë—Ä–∞—É–∑–µ—Ä–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è** - –¥–µ—è–∫—ñ –±—Ä–∞—É–∑–µ—Ä–∏ –º–æ–∂—É—Ç—å –±–ª–æ–∫—É–≤–∞—Ç–∏ cookies

## üîí –ë–µ–∑–ø–µ–∫–∞

- Cookies –º–∞—é—Ç—å `SameSite=Lax` –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ CSRF
- –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 30 –¥–Ω—ñ–≤
- –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ

## üì± –ì—ñ–¥—Ä–∞—Ç–∞—Ü—ñ—è

–î–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –∑ –≥—ñ–¥—Ä–∞—Ç–∞—Ü—ñ—î—é –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `mounted` —Å—Ç–∞–Ω:

```typescript
const [mounted, setMounted] = useState(false)

useEffect(() => {
  setMounted(true)
}, [])

// –ü–æ–∫–∞–∑—É–π—Ç–µ UI —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è
{mounted && <CartIndicator count={itemCount} />}
```
