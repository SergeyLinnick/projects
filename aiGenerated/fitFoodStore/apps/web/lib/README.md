# Cookie-based State Management with Cross-Tab Synchronization & Cart Validation

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î cookies –∑–∞–º—ñ—Å—Ç—å localStorage –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ—Ä–∑–∏–Ω–∏, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫—Ä–∞—â—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É SSR —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∞ –∫–ª—ñ—î–Ω—Ç–æ–º. **–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ—Ä–∑–∏–Ω–∏ –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–∞ **—Å–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ—Ä–∑–∏–Ω–∏** –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
lib/
‚îú‚îÄ‚îÄ store.ts                    # Zustand store –∑ cookie persistence —Ç–∞ cross-tab sync
‚îú‚îÄ‚îÄ cookies.ts                  # –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cookies
‚îú‚îÄ‚îÄ server-cookies.ts           # –°–µ—Ä–≤–µ—Ä–Ω—ñ —Ö—É–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ cookies
‚îú‚îÄ‚îÄ validation.ts               # Zod —Å—Ö–µ–º–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ cart-validator.ts           # –°–µ—Ä–≤–µ—Ä–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–æ—Ä–∑–∏–Ω–∏
‚îú‚îÄ‚îÄ sync-test-utils.ts          # –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
‚îî‚îÄ‚îÄ README.md                   # –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

components/
‚îú‚îÄ‚îÄ sync-indicator.tsx          # –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ sync-debugger.tsx           # Debug –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏)
‚îî‚îÄ‚îÄ cart-validation-display.tsx # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

hooks/
‚îú‚îÄ‚îÄ use-cross-tab-sync.ts       # –•—É–∫ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cross-tab sync
‚îî‚îÄ‚îÄ use-cart-validation.ts      # –•—É–∫ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–æ—Ä–∑–∏–Ω–∏

api/
‚îî‚îÄ‚îÄ cart/
    ‚îî‚îÄ‚îÄ validate/
        ‚îî‚îÄ‚îÄ route.ts            # API endpoint –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–æ—Ä–∑–∏–Ω–∏
```

## üîß –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. `store.ts` - Zustand Store –∑ Cross-Tab Sync

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `createJSONStorage` –¥–ª—è cookie persistence
- **–ù–æ–≤–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏
- –ü—ñ–¥—Ç—Ä–∏–º—É—î `BroadcastChannel` API —Ç–∞ fallback –Ω–∞ storage events
- –í–∫–ª—é—á–∞—î —Å—Ç–∞–Ω `isSyncing` –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- **–ù–æ–≤–æ**: –ú–µ—Ç–æ–¥ `validateCartState` –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

### 2. `validation.ts` - Zod –°—Ö–µ–º–∏ –í–∞–ª—ñ–¥–∞—Ü—ñ—ó

- `CartItemSchema` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –æ–∫—Ä–µ–º–æ–≥–æ —Ç–æ–≤–∞—Ä—É
- `CartStateSchema` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ç–∞–Ω—É –∫–æ—Ä–∑–∏–Ω–∏
- `CartSyncSchema` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- `CartValidationRequestSchema` - —Å—Ö–µ–º–∞ –∑–∞–ø–∏—Ç—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
- `CartValidationResponseSchema` - —Å—Ö–µ–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

### 3. `cart-validator.ts` - –°–µ—Ä–≤–µ—Ä–Ω–∞ –í–∞–ª—ñ–¥–∞—Ü—ñ—è

- **–ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞**: –ª—ñ–º—ñ—Ç–∏ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ, —Ü—ñ–Ω, —Ç–æ–≤–∞—Ä—ñ–≤
- **–ë–µ–∑–ø–µ–∫–∞**: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –ø–∞—Ç–µ—Ä–Ω—ñ–≤, XSS –∑–∞—Ö–∏—Å—Ç
- **–ê–Ω–æ–º–∞–ª—ñ—ó**: –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö –∑–º—ñ–Ω
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: —ñ—Å—Ç–æ—Ä—ñ—è –≤–∞–ª—ñ–¥–∞—Ü—ñ–π, –ø–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏

### 4. **–ù–æ–≤–æ**: Cart Validation API

- **POST** `/api/cart/validate` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ—Ä–∑–∏–Ω–∏
- **GET** `/api/cart/validate` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑ cookies
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤

### 5. **–ù–æ–≤–æ**: Client-Side Validation Hook

- `useCartValidation()` - —Ö—É–∫ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–æ—Ä–∑–∏–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö
- –®–≤–∏–¥–∫–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- –°—Ç–∞–Ω –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –ø–æ–º–∏–ª–æ–∫

### 6. **–ù–æ–≤–æ**: Validation Display Component

- `CartValidationDisplay` - –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- –ü–æ–∫–∞–∑—É—î –ø–æ–º–∏–ª–∫–∏, –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ —Å—Ç–æ—Ä–æ–Ω–∞:

```typescript
import { useCartStore } from "@/lib/store";
import { useCartValidation } from "@/hooks/use-cart-validation";

const { addToCart, items, isSyncing } = useCartStore();
const { isValid, errors, warnings, validateCart } = useCartValidation();
```

### –°–µ—Ä–≤–µ—Ä–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞:

```typescript
import { getServerCartItemCount } from "@/lib/server-cookies";
import { cartValidator } from "@/lib/cart-validator";

export default function Layout() {
  const cartItemCount = getServerCartItemCount();
  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ cartItemCount –¥–ª—è SSR
}
```

### Cross-Tab Sync:

```typescript
import { useCrossTabSync } from "@/hooks/use-cross-tab-sync";

const { tabId, syncCount, isSyncing, testSync } = useCrossTabSync();
```

### Cart Validation:

```typescript
import { useCartValidation } from "@/hooks/use-cart-validation";

const { validateCart, quickValidate, isValid, errors } = useCartValidation();

// –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
await validateCart();

// –®–≤–∏–¥–∫–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
quickValidate();
```

## üîÑ Cross-Tab Synchronization

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:

1. **BroadcastChannel API** (—Å—É—á–∞—Å–Ω—ñ –±—Ä–∞—É–∑–µ—Ä–∏):
   - –°—Ç–≤–æ—Ä—é—î –∫–∞–Ω–∞–ª `cart-sync` –¥–ª—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –∑–º—ñ–Ω—ñ –∫–æ—Ä–∑–∏–Ω–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î —Å—Ç–∞–Ω –≤ —ñ–Ω—à–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö

2. **Storage Events** (fallback –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤):
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `storage` event –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ –∑–º—ñ–Ω—ñ cookies
   - –ó–∞–±–µ–∑–ø–µ—á—É—î —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ —É—Å—ñ–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è**:
   - –ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ/–≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É
   - –ü—Ä–∏ –∑–º—ñ–Ω—ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ
   - –ü—Ä–∏ –æ—á–∏—â–µ–Ω–Ω—ñ –∫–æ—Ä–∑–∏–Ω–∏

## ‚úÖ Cart Validation

### –†—ñ–≤–Ω—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:

1. **–ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** (—à–≤–∏–¥–∫–∞):
   - –ë–∞–∑–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
   - –õ—ñ–º—ñ—Ç–∏ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ç–∞ —Ü—ñ–Ω
   - –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—Ä–æ–∂–Ω—é –∫–æ—Ä–∑–∏–Ω—É

2. **–°–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** (–ø–æ–≤–Ω–∞):
   - –í–∞–ª—ñ–¥–∞—Ü—ñ—è Zod —Å—Ö–µ–º
   - –ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ —Ç–∞ –ª—ñ–º—ñ—Ç–∏
   - –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–Ω–æ–º–∞–ª—ñ—ó
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—è

### –ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:

- **–ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä—ñ–≤**: 50 —Ä—ñ–∑–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
- **–ú–∞–∫—Å–∏–º—É–º –∫—ñ–ª—å–∫–æ—Å—Ç—ñ**: 100 —à—Ç—É–∫ –Ω–∞ —Ç–æ–≤–∞—Ä
- **–ú–∞–∫—Å–∏–º—É–º –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ**: 1000 —à—Ç—É–∫
- **–ú–∞–∫—Å–∏–º—É–º —Ü—ñ–Ω–∏**: 1,000,000 –≥—Ä–Ω
- **–ú—ñ–Ω—ñ–º—É–º —Ü—ñ–Ω–∏**: 0.01 –≥—Ä–Ω

### –ë–µ–∑–ø–µ–∫–∞:

- **XSS –∑–∞—Ö–∏—Å—Ç**: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –ø–∞—Ç–µ—Ä–Ω—ñ–≤
- **URL –≤–∞–ª—ñ–¥–∞—Ü—ñ—è**: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–æ–±—Ä–∞–∂–µ–Ω—å
- **–ê–Ω–æ–º–∞–ª—ñ—è –¥–µ—Ç–µ–∫—à–Ω**: –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö –∑–º—ñ–Ω
- **–Ü—Å—Ç–æ—Ä—ñ—è –≤–∞–ª—ñ–¥–∞—Ü—ñ–π**: –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

### 1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫—ñ–ª—å–∫–∞ –≤–∫–ª–∞–¥–æ–∫ –∑ –≤–∞—à–∏–º —Å–∞–π—Ç–æ–º

### 2. –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –≤ –æ–¥–Ω—ñ–π –≤–∫–ª–∞–¥—Ü—ñ

### 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –∫–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–∏–ª–∞—Å—è –≤ —ñ–Ω—à–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö

### 4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ debug –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

### Debug –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—É—î:

- –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –≤–∫–ª–∞–¥–∫–∏
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ–π
- –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å
- –¢–µ—Å—Ç–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

### 1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–æ—Ä–∑–∏–Ω–∏ (`/cart`)

### 2. –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `CartValidationDisplay`

### 3. –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞–π—Ç–µ –∑–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é

### 4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API endpoint: `GET /api/cart/validate`

### 5. –¢–µ—Å—Ç—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó:

- –ü–æ—Ä–æ–∂–Ω—è –∫–æ—Ä–∑–∏–Ω–∞
- –ó–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ —Ç–æ–≤–∞—Ä—ñ–≤
- –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —Ü—ñ–Ω–∏
- –ü—ñ–¥–æ–∑—Ä—ñ–ª—ñ –ø–∞—Ç–µ—Ä–Ω–∏

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ cookies –Ω–∞–¥ localStorage

1. **SSR –ø—ñ–¥—Ç—Ä–∏–º–∫–∞** - –¥–∞–Ω—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
2. **–ö—Ä–∞—â–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∞ –∫–ª—ñ—î–Ω—Ç–æ–º
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è** - –∑ –∫–æ–∂–Ω–∏–º HTTP –∑–∞–ø–∏—Ç–æ–º
4. **–ë–µ–∑–ø–µ–∫–∞** - –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ httpOnly, secure —Ñ–ª–∞–≥–∏
5. **Cross-tab sync** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏
6. **–°–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** - –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ

## ‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–Ω—è

1. **–†–æ–∑–º—ñ—Ä** - cookies –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω–Ω—è 4KB
2. **–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è** - cookies –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∑ –∫–æ–∂–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º
3. **–ë—Ä–∞—É–∑–µ—Ä–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è** - –¥–µ—è–∫—ñ –±—Ä–∞—É–∑–µ—Ä–∏ –º–æ–∂—É—Ç—å –±–ª–æ–∫—É–≤–∞—Ç–∏ cookies
4. **–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫–∞ –≤ 100-200ms –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏
5. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** - —Å–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –º–æ–∂–µ –∑–∞–π–º–∞—Ç–∏ 100-500ms

## üîí –ë–µ–∑–ø–µ–∫–∞

- Cookies –º–∞—é—Ç—å `SameSite=Lax` –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ CSRF
- –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 30 –¥–Ω—ñ–≤
- –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ
- Cross-tab sync –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–µ–∑–ø–µ—á–Ω—ñ –∫–∞–Ω–∞–ª–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
- **–ù–æ–≤–æ**: –°–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑ XSS –∑–∞—Ö–∏—Å—Ç–æ–º
- **–ù–æ–≤–æ**: –î–µ—Ç–µ–∫—à–Ω –∞–Ω–æ–º–∞–ª—ñ–π —Ç–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –ø–∞—Ç–µ—Ä–Ω—ñ–≤

## üì± –ì—ñ–¥—Ä–∞—Ç–∞—Ü—ñ—è

–î–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –∑ –≥—ñ–¥—Ä–∞—Ç–∞—Ü—ñ—î—é –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `mounted` —Å—Ç–∞–Ω:

```typescript
const [mounted, setMounted] = useState(false)

useEffect(() => {
  setMounted(true)
}, [])

// –ü–æ–∫–∞–∑—É–π—Ç–µ UI —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è
{mounted && <CartIndicator count={itemCount} />}
```

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó** - –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –∫—ñ–ª—å–∫–∞ –≤–∫–ª–∞–¥–æ–∫
2. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó** - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä—ñ–∑–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó
3. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ debug –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
4. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** - –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–∞—Ç—Ä–∏–º–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
5. **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è** - –¥–æ–¥–∞–π—Ç–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–ª—è —ñ–Ω—à–∏—Ö –¥–∞–Ω–∏—Ö
6. **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞** - –∑–±–∏—Ä–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞–ª—ñ–¥–∞—Ü—ñ–π
